<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no, address=no, email=no">
<title>MyKia :: My Kia News :: list</title>
<link rel="stylesheet" type="text/css" href="../bower_components/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../css/morpheus_style.css">
<script type="text/javascript" src="../js/mcore.min.js"></script>
</head>
<body id="mk_e01_0001">
<!-- ========== Start ========== -->

<div id="wrapper">
    <header id="header">
        <h1><!-- My Kia News --><script type="text/javascript">M.locale.localizedWrite("G1_1")</script></h1>
        <button type="button" class="hbtn fl home">Home</button>
    </header>

	<section id="container" class="container">
		<div id="scroll">
			<div class="row">
				<ul id="list">
					<!--li>
						<a href="mk_e01_0002.html">
							<div class="thum"><img src="https://www.kia.com:443/se/-/media/se/mykia/news/nya-sportage-sweden.ashx?mw=800&mh=800" alt=""></div>
							<p>I Re della Corea</p>
							<i>Technology <span>13 Jun 2016</span></i>
						</a>
					</li-->
				</ul>
				<button class="btn_red_round paging_btn" style="display:none"><script type="text/javascript">M.locale.localizedWrite("D1_20")</script></button>
			</div>
			<!-- No Search Result -->
            <div class="result_none none">
                <p><script type="text/javascript">M.locale.localizedWrite("D1_16")</script></p>
            </div>
            
		</div>
	</section>

	<footer id="footer">
		<p class="img">KIA, The Power to Surprise.</p>
	</footer>
</div>

<!-- ========== //End ========== -->
</body>
<script type="text/javascript" src="../bower_components/moment/min/moment-with-locales.min.js"></script>
<script type="text/javascript" src="../js/ui/common.js"></script>
<script type="text/javascript">
var dummyUl = $('<ul></ul>');
var gvlNewsCallback = {
	success:function(rev,setting){
		var  news = sortList(rev.News)
			,str = ''
			,newsDate
			,hasRead

		for (var i in news) {
			if(news[i].NewsCategory == 0){
				newsDate = JsUtil.MomentDateFormat(news[i].NewsDate, 'LL');

				if (newsDate == 'Invalid date') {
					newsDate = '';
				}
				
				hasRead = '';
				if (news[i].NewsRead == true) {
					hasRead = 'has-read';
				}

				str += '<li data-news="' + news[i].NewsId + '" data-category="'+ news[i].NewsCategory+'" class="' + hasRead + '">';
				str += '	<a href="#">';

				if (M.locale.VirtualMode) {
					str += '		<div class="thum" style="background-image:url(' + "data:"+news[i].NewsImageExtension+";base64,"+news[i].NewsImage + ')"></div>';
				} else {
					str += '		<div class="thum" style="background-image:url(' + news[i].NewsImageUrl + ')"></div>';
				}

				//str += '		<div class="thum" style="background-image:url(' + news[i].NewsImageUrl + '?mw=200)"></div>';
				str += '		<p>' + news[i].NewsTitle + '</p>';
				str += '		<i><span>' + getMagazineCategoryString( news[i].MagazineCategory ) + '</span><br />' + newsDate + '</i>';
				str += '	</a>';
				str += '</li>';
			}
		}
		dummyUl.html(str)

		if(str != ''){
			showMore();
			$('.paging_btn').css('display','block');
		}
		
		
		$('#list').on('click', '[data-news]', function(){
			var  $this = $(this)
				,options=Options.Default
				,newsid = $this.data('news')

			// 각 리스트 터치 시 해당 내용에 맞는 유튜브 링크로 연결이 된다.
			if (!$this.hasClass("has-read")) {

				// 이전에 읽지 않은 리스트 인 경우 API 2.22 통신을 시작한다
				new NetworkManager(TrCode.NewsRead, {success:function(rev,setting){

					// API 2.22 통신 성공 시 읽지 않은 비디오 카운트를 갱신한다.

					var loginInfo = LoginManager.getLoginInfo();
					loginInfo.Notification.MyKiaNewsCnt--;
					LoginManager.setLoginInfo(loginInfo);

					$this.addClass('has-read');
					options.param = {
						 'newsId' : newsid
					};
					Page.moveToPage('mk_e01_0002', options);
				}, error:function(code,msg,setting) {
					void(0);
				}}, false, {show:false}).send({
					CustomerId : LoginManager.getCustomerId(),
					NewsCategory : 0,
					NewsId : newsid
				});
			}else{
				options.param = {
					 'newsId' : newsid
				};
				Page.moveToPage('mk_e01_0002', options);
			}
		})
	}
}
gvlNewsNetwork = new NetworkManager(TrCode.NewsListV2, gvlNewsCallback, true);

// 최초 진입 시 API 2.18 통신을 시작한다.
M.onReady(function(e){
	gvlNewsNetwork.send({
		CustomerId : LoginManager.getCustomerId()
	});

	

	$('.paging_btn').click(function(){
		showMore();
	})

	// 최초 진입 시 벨기에는 언어선택 노출
	/* var marketId = LoginManager.getDetailsInfo().MarketId;
	console.log(marketId);
	if(marketId != null && (marketId == 'KMBE' || marketId == 'KMLU')){
		$('#language').show();
	} */
});

function showMore(){
	for(var i=0; i<5; i++){
		if(dummyUl.find('li').length == 0){
			break;
		}
		$('#list').append(dummyUl.find('li:first-child'))
	}
}


// news 날짜순 정렬
function sortList(list) {
	list.sort(function(a, b) {
		if (a.NewsDate > b.NewsDate) {
			return -1;
		}
		return 1;
	})
	return list;
}

</script>
</html>

