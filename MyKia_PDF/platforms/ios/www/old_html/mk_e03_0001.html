<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no, address=no, email=no">
<title>MyKia :: MyKia Video :: list</title>
<link rel="stylesheet" type="text/css" href="../css/morpheus_style.css">
<script type="text/javascript" src="../js/mcore.min.js"></script>
<style type="text/css">
.iOS_li{padding-top: 0 !important; border-bottom: 1px solid #ccc !important;}

#mk_e03_0001 li {padding-top:0;}
#mk_e03_0001 #container {padding:0; padding-top:4.3rem;}
</style>
</head>
<body id="mk_e03_0001">
<!-- ========== Start ========== -->

<div id="wrapper">
	<header id="header">
		<h1><script type="text/javascript">M.locale.localizedWrite("G1_5")</script></h1>
        <button type="button" class="hbtn fl home">Home</button>
	</header>

	<section id="container">
		<div id="scroll">
        <!-- contents_Start -->
        
			<!-- <ul id="videoList" class="tab_space">
				<li>
					<p class="img_space">
						<img id="newsImage1" src="../img/@sum_vedio.png" alt=""/>
						<button type="button">PLAY</button>
					</p>
					<p class="tit_video ellipsis">summary Text D/P</p>
				</li>
			</ul> -->
			<ul class="li_youtube" id="videoList">
				<!-- youtube 
				<li class="youtube">
					<button type="button">
						<p>SMART TAILGATE</p>
						<p>http://youtu.be/xodpYoxzVBk</p>
					</button>
				</li> -->
			</ul>

			<!-- No Search Result -->
            <div class="result_none none">
                <p><script type="text/javascript">M.locale.localizedWrite("D1_16")</script></p>
            </div>
        <!-- //contents_End -->
		</div>
	</section>

	<footer id="footer">
		<p class="img">KIA, The Power to Surprise.</p>
	</footer>
</div>

<!-- ========== //End ========== -->
</body>
<script type="text/javascript" src="../js/ui/common.js"></script>
<script type="text/javascript">
//2. This code loads the IFrame Player API code asynchronously.
var tag = document.createElement('script');

tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var platform = MApi.getPlatform();
var newsReads = {},
	playVideoId,
	player
	playList = [];
var gvlNewsCallback={
	success:function(rev,setting){
		var unSeenCnt = 0;
		$(rev.Video).each(function(idx,item){
			if(item.NewsCategory==2){
				// videoUrl parsing
				var video = JsUtil.getVideo(item.VideoUrl);
				var targetId = "video_"+idx;
				var temp = $("<li></li>")
				.append(
					$('<img/>').attr("src", video.thumbnailUrl)
				)
				.append(
					$("<button></button>")
					.append($("<p></p>").text(item.VideoTitle))
					//.append($("<p></p>").text(item.VideoUrl).addClass("ellipsis"))
				)
				.append(
					$("<div></div>").addClass("youtube_player")
				)
				.data(Scheme.Url,item.VideoUrl)
				.click(function(){
					if(player){
						console.log(player);
						player.clearVideo();
						player.destroy();
						player = null;
					}
					if($(this).find('button').hasClass("on")){
						//$(this).find('.youtube_player').html('');
						$(this).find('button').removeClass("on");
						$('.youtube_player').not(_player).slideUp();
					}else{
						var _player = $(this).find('.youtube_player')
						var _iframe = $('<div></div>').attr("id", targetId)
						
						$('.li_youtube li button').not($(this).find('button')).removeClass('on');
						$('.youtube_player').not(_player).slideUp();

						_iframe.src = item.VideoUrl;
						_player.append(_iframe);
						$(this).append(_player);
						_player.slideDown();
						$(this).find('button').addClass("on");
						
						player = new YT.Player(targetId, {
						    height: '200px',
						    width: '100%',
						    playerVars: { 'list': video.list,'autoplay': 1 },
						    videoId: video.videoId,
						    events: {
						    }
						});

						playVideoId = targetId;
					}
				}).click(function() {

					// 각 리스트 터치 시 해당 내용에 맞는 유튜브 링크로 연결이 된다.
					var target = $(this);
					if (!target.data("isRead")) {

						// 이전에 읽지 않은 리스트 인 경우 API 2.22 통신을 시작한다
						new NetworkManager(TrCode.NewsRead, {success:function(rev,setting){

							// API 2.22 통신 성공 시 읽지 않은 비디오 카운트를 갱신한다.
							target.data("isRead", true);
							var loginInfo = LoginManager.getLoginInfo();
							loginInfo.Notification.How2VideoCnt--;
							LoginManager.setLoginInfo(loginInfo);
						}, error:function(code,msg,setting) {
							void(0);
						}}, false, {show:false}).send({
							CustomerId : LoginManager.getCustomerId(),
							NewsCategory : item.NewsCategory,
							NewsId : target.data("newsId")
						});
					}
				}).data("isRead", item.NewsRead).data("newsId", item.NewsId);
				if (!item.NewsRead) {
					unSeenCnt++;
				}
				else {
					temp.find("button").addClass("read");
				}
				temp.appendTo("#videoList");
			}
		});

		if($("#videoList > li").size()==0){
			$('.result_none').removeClass('none');
		}
		
		var loginInfo = LoginManager.getLoginInfo();
		loginInfo.Notification.How2VideoCnt = unSeenCnt;
		LoginManager.setLoginInfo(loginInfo);

		WN2CommonAsync("exWNNetworkIndicatorRemoveAll");
	}
},
gvlNewsNetwork=new NetworkManager(TrCode.NewsListVideo,gvlNewsCallback,true);

function androidList(rev){
	var unSeenCnt = 0;
	$(rev.Video).each(function(idx,item){
		if(item.NewsCategory==2){
			// videoUrl parsing
			var video = JsUtil.getVideo(item.VideoUrl);
			var targetId = "video_"+idx;
			console.log(video);
			var temp = $("<li></li>")
			.append($("<div></div>").attr("id", targetId))
//			.append($("<iframe height='200px' style='width:100%;'></iframe>").attr("id", targetId).attr("src",video.videoUrl))
			.append(
				$("<p></p>").text(item.VideoTitle).addClass("tit_video ellpsis")
			);
			newsReads[targetId] = item
			if (!item.NewsRead) {
				unSeenCnt++;
			}else {
				//temp.find("button").addClass("read");
			}
			temp.appendTo("#videoList");

			var player = new YT.Player(targetId, {
			    height: '200px',
			    width: '100%',
			    playerVars: { 'list': video.list },
			    videoId: video.videoId,
			    events: {
			    	'onStateChange': onPlayerStateChange
			    }
			});
		}
	});
	return unSeenCnt;
}

function iOSList(rev){
	var unSeenCnt = 0;
	var videoCnt = [];
	var itemList = [];

	$(rev.Video).each(function(idx,item){
 		if(item.NewsCategory==2){
 			itemList.push(item);
 		}
	});

	/* if(itemList.length == 1){
		// videoUrl parsing
		var item = itemList[0];
		var video = JsUtil.getVideo(item.VideoUrl);
		var targetId = "video_0";
		var temp = $("<li></li>")
		.append($("<div></div>").attr("id", targetId))
//		.append($("<iframe height='200px' style='width:100%;'></iframe>").attr("id", targetId).attr("src",video.videoUrl))
		.append(
			$("<p></p>").text(item.VideoTitle).addClass("tit_video ellpsis")
		);
		newsReads[targetId] = item
		if (!item.NewsRead) {
			unSeenCnt++;
		}else {
			//temp.find("button").addClass("read");
		}
		temp.appendTo("#videoList");

		var player = new YT.Player(targetId, {
		    height: '200px',
		    width: '100%',
		    playerVars: { 'list': video.list },
		    videoId: video.videoId,
		    events: {
		    	'onStateChange': onPlayerStateChange
		    }
		});
	}else{ */
		$(itemList).each(function(idx,item){
			// videoUrl parsing
			var video = JsUtil.getVideo(item.VideoUrl);
			var targetId = "video_"+idx;
			var temp = $("<li></li>").addClass("iOS_li")
			.append(
				$('<img/>').attr("src", video.thumbnailUrl)
			)
			.append(
				$("<button></button>")
				.append($("<p></p>").text(item.VideoTitle))
			)
			.append(
				$("<div></div>").addClass("youtube_player")
			)
			.data(Scheme.Url,item.VideoUrl)
			.click(function(){
				if(player){
					console.log(player);
					player.clearVideo();
					player.destroy();
					player = null;
				}
				if($(this).find('button').hasClass("on")){
					//$(this).find('.youtube_player').html('');
					$(this).find('button').removeClass("on");
					$('.youtube_player').not(_player).slideUp();
				}else{
					var _player = $(this).find('.youtube_player')
					var _iframe = $('<div></div>').attr("id", targetId)
					
					$('.li_youtube li button').not($(this).find('button')).removeClass('on');
					$('.youtube_player').not(_player).slideUp();
		
					_iframe.src = item.VideoUrl;
					_player.append(_iframe);
					$(this).append(_player);
					_player.slideDown();
					$(this).find('button').addClass("on");
					
					player = new YT.Player(targetId, {
					    height: '200px',
					    width: '100%',
					    playerVars: { 'list': video.list },
					    videoId: video.videoId,
					    events: {
					    }
					});
		
					playVideoId = targetId;
				}
			}).click(function() {
		
				// 각 리스트 터치 시 해당 내용에 맞는 유튜브 링크로 연결이 된다.
				var target = $(this);
				if (!target.data("isRead")) {
		
					// 이전에 읽지 않은 리스트 인 경우 API 2.22 통신을 시작한다
					new NetworkManager(TrCode.NewsRead, {success:function(rev,setting){
		
						// API 2.22 통신 성공 시 읽지 않은 비디오 카운트를 갱신한다.
						target.data("isRead", true);
						var loginInfo = LoginManager.getLoginInfo();
						loginInfo.Notification.MyKiaVideoCnt--;
						LoginManager.setLoginInfo(loginInfo);
					}, error:function(code,msg,setting) {
						void(0);
					}}, false, {show:false}).send({
						CustomerId : LoginManager.getCustomerId(),
						NewsCategory : item.NewsCategory,
						NewsId : target.data("newsId")
					});
				}
			}).data("isRead", item.NewsRead).data("newsId", item.NewsId);

			if (!item.NewsRead) {
				unSeenCnt++;
			}else {
				temp.find("button").addClass("read");
			}
			temp.appendTo("#videoList");
		});

		/* $('#container').removeAttr("style");
		$('#videoList').removeClass("li_youtube");
		$('#videoList').addClass("tab_space");
		$(itemList).each(function(idx,item){
			var imageUrl = item.VideoImageUrl
			if (M.locale.VirtualMode) {
				imageUrl = "data:"+item.VideoImageExtend+";base64,"+item.VideoImage;
			}
			// videoUrl parsing
			var video = JsUtil.getVideo(item.VideoUrl);
			var targetId = "video_"+idx;
			console.log(video);
			var temp = $("<li></li>")
			.append($("<div></div>").attr("id", targetId))
			.append(
				$("<p></p>").addClass("img_space").append(
					$("<img>").attr("src",  imageUrl)
					.click(function() {
							if(player){
								console.log(player);
								player.clearVideo();
								player = null;
							}
							
							if(playVideoId){
								$("#"+playVideoId).replaceWith($("<div></div>").attr("id", playVideoId));
							}
							
							// 리스트 터치 시 API 2.22 통신을 시작한다. 내장 웹브라우져를 연동하여 링크를 호출한다
							var target = $(this);
							if (!target.data("isRead")) {
								new NetworkManager("HTTPS_RHM", TrCode.NewsRead, {success:function(rev,setting){
									
									// API 2.22 통신 결과 성공 시 홈에 표시하는 MyKia Video 뱃지 카운트를 감소 시킨다.
									target.data("isRead", true);
									var loginInfo = LoginManager.getLoginInfo();
									loginInfo.Notification.MyKiaVideoCnt--;
									LoginManager.setLoginInfo(loginInfo);
								}, error:function(code,msg,setting) {
									void(0);
								}}, false, {show:false}).send({
									CustomerId : LoginManager.getCustomerId(),
									NewsCategory : item.NewsCategory,
									NewsId : target.data("newsId")
								});
							}

							$(".img_space").show();
							target.parent(".img_space").hide();
							$("p_"+idx).show();

							player = new YT.Player(targetId, {
							    height: '200px',
							    width: '100%',
							    playerVars: { 'list': video.list },
							    videoId: video.videoId,
							    events: {
							    	//'onStateChange': onPlayerStateChange
							    }
							});

							playVideoId = targetId;
						}).data("isRead", item.NewsRead).data("newsId", item.NewsId)
				).append(
					$("<button></button>").attr("type", "button").text("PLAY")
						
				)
			).append(
				$("<p></p>").text(item.VideoTitle).addClass("tit_video ellpsis")
			);
			if (!item.NewsRead) {
				unSeenCnt++;
			}
			else {
				temp.find("button").addClass("read");
			}
			temp.appendTo($("#videoList"));
		});*/
	//}
	
	return unSeenCnt;
}

function onPlayerStateChange(event) {
	if(event.data == YT.PlayerState.BUFFERING){
		console.log(event);
		if (!newsReads[event.target.h.id].NewsRead) {
			new NetworkManager(TrCode.NewsRead, {success:function(rev,setting){
				// API 2.22 통신 결과 성공 시 홈에 표시하는 MyKia Video 뱃지 카운트를 감소 시킨다.
				newsReads[event.target.h.id].NewsRead = true;
				var loginInfo = LoginManager.getLoginInfo();
				loginInfo.Notification.MyKiaVideoCnt--;
				LoginManager.setLoginInfo(loginInfo);
			}, error:function(code,msg,setting) {
				void(0);
			}}, false, {show:false}).send({
				CustomerId : LoginManager.getCustomerId(),
				NewsCategory : newsReads[event.target.h.id].NewsCategory,
				NewsId : newsReads[event.target.h.id].NewsId
			});
		}
	}
}

// 최초 진입 시 API 2.20 통신을 시작한다.
M.onReady(function(e){
	gvlNewsNetwork.send({
		CustomerId : LoginManager.getCustomerId()
	});
});

</script>
</html>