<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Zoom In/Out
  </h1>
</section>
<!-- Main content -->
<section class="content">
  <!-- Small boxes (Stat box) -->
  <div class="row">
    <style>
      div#zoomContents {
      border:1px solid #999;
      width:100%;
      height:100%;
      max-height:300px;
      overflow:hidden;
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;
      }
      #target {
      background: white;
      }
    </style>
    <div id="zoomContents">
      <div id="target">
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
          <p>Zoom In/Out scale test</p>
      </div>
      <!-- UI for logging/debugging -->
    </div>
    <p>touch start point X : <span id="startAbsX"></span></p>
    <p>touch start point Y : <span id="startAbsY"></span></p>
    <p>touch move point X : <span id="moveAbsX"></span></p>
    <p>touch move point Y : <span id="moveAbsY"></span></p>
    <p>touch end point X : <span id="endAbsX"></span></p>
    <p>touch end point Y : <span id="endAbsY"></span></p>
  </div>
  <!-- /.row -->
</section>
<!-- /.content -->
<script type="text/javascript">
  var pinchZoom = {
    obj:{
      startAbsX:0, // touch start point X
      startAbsY:0, // touch start point y
      moveAbsX:0, // touch move point x
      moveAbsY:0, // touch move point y
      endAbsX:0, // touch end point x
      endAbsY:0, // touch end point y
      elWidth:0, // wrapper width : scale 비율 계산에 사용 (터치 포인트 이동거리 X / wrapper width)
      elHeight:0, // wrapper height : scale 비율 계산에 사용  (토치 포인트 이동거리 Y / wrapper height)
      oldScale:1 // 마지막 scale size 저장
      nowScale:1 // 현재 scale size
    },
    el:null,
    init:function(t){
      // target element
      pinchZoom.el = document.querySelector(t);

      // target element의 wrapper 넓이와 높이를 저장한다.
      pinchZoom.obj.elWidth = pinchZoom.el.parentNode.offsetWidth;
      pinchZoom.obj.elHeight = pinchZoom.el.parentNode.offsetHeight;

      // 터치 이벤트 등록  
      pinchZoom.el.addEventListener('touchstart', pinchZoom.fnTouchStart, false);
      pinchZoom.el.addEventListener('touchmove', pinchZoom.fnTouchMove, false);
      pinchZoom.el.addEventListener('touchend', pinchZoom.fnTouchEnd, false);
      
    },
    // touch start event
    fnTouchStart:function(evt){
      // touch point가 두개일 때만 동작
      if(evt.touches.length == 2){
        // Multi touch가 시작 되면 Body 의 scrolling을 막는다.
        document.body.style.overflow = "hidden";

        // 최종 스케일 사이즈를 현재 사이즈에 저장한다.
        pinchZoom.obj.nowScale = pinchZoom.obj.oldScale


        // 최초 터치시 두 포인트간의 거리를 구함 (절대값으로 저장)
        pinchZoom.obj.startAbsX = Math.abs(evt.touches[0].clientX - evt.touches[1].clientX);
        pinchZoom.obj.startAbsY = Math.abs(evt.touches[0].clientY - evt.touches[1].clientY);
  
        document.getElementById('startAbsX').innerHTML = pinchZoom.obj.startAbsX;
        document.getElementById('startAbsY').innerHTML = pinchZoom.obj.startAbsY;
      }
    },
    // touch move event
    fnTouchMove:function(evt){
      // touch point가 두개일 때만 동작
      if(evt.touches.length == 2){

        // 두 포인트간의 거리를 구함 (절대값으로 저장)
        pinchZoom.obj.moveAbsX = Math.abs(evt.touches[0].clientX - evt.touches[1].clientX);
        pinchZoom.obj.moveAbsY = Math.abs(evt.touches[0].clientY - evt.touches[1].clientY);

        // scale 값 변경
        pinchZoom.fnZoomScale();

        document.getElementById('moveAbsX').innerHTML = pinchZoom.obj.moveAbsX;
        document.getElementById('moveAbsY').innerHTML = pinchZoom.obj.moveAbsY;
      }
    },
    fnTouchEnd:function(evt){
        // touch가 끝나면 body의 scroll을 풀어준다.
        document.body.style.overflow = "scroll";

        // 현재 스케일 사이즈를 최종 사이즈에 저장한다.
        pinchZoom.obj.oldScale = pinchZoom.obj.nowScale;

        // 최종 위치 저장
        pinchZoom.obj.endAbsX = Math.abs(evt.touches[0].clientX - evt.touches[1].clientX);
        pinchZoom.obj.endAbsY = Math.abs(evt.touches[0].clientY - evt.touches[1].clientY);
  
        document.getElementById('endAbsX').innerHTML = pinchZoom.obj.endAbsX;
        document.getElementById('endAbsY').innerHTML = pinchZoom.obj.endAbsY;
    },
    fnZoomScale:function(){
      var scaleX = (pinchZoom.obj.moveAbsX - pinchZoom.obj.startAbsX) / (pinchZoom.obj.elWidth * 30) ;
      var scaleY = (pinchZoom.obj.moveAbsY - pinchZoom.obj.startAbsY) / (pinchZoom.obj.elHeight * 30);

      var currentScale =  pinchZoom.obj.nowScale + (scaleX + scaleY) / 2;

      if(currentScale < 1){
        currentScale = 1;
      }else if (currentScale > 3){
        currentScale = 3;
      }

      pinchZoom.el.style.transform = "scale("+currentScale+")";
    }
  }
  
  pinchZoom.init('#target');
</script>