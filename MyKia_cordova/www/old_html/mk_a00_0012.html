<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no, address=no, email=no">
<title>MyKia :: Select Your Country</title>
<link rel="stylesheet" type="text/css" href="../css/morpheus_style.css">
<style>
/*#scroll {padding-top:8rem;}*/
.selected-country {position:absolute; top:4.3rem; left:0; display:block; border-bottom:1px solid #999; width:100%; background:#fff; height:8rem; font-size:2rem; padding:2rem; z-index:10;}
.selected-country>span {display:inline-block; height:4rem; line-height:4rem; color:#bb162b;}
.selected-country>strong {display:inline-block; height:4rem; line-height:4rem; color:#bb162b;}
</style>
<script type="text/javascript" src="../js/mcore.min.js"></script>
</head>
<body id="mk_a00_0012">
<!-- ========== Start ========== -->

<div id="wrapper">
	<header id="header">
		<h1><!-- Please Select Your Country --><script type="text/javascript">M.locale.localizedWrite("T1_4")</script></h1>
	</header>

	<section id="container" class="fix-bottom">
		<!-- <div class="selected-country">
			<span><script type="text/javascript">M.locale.localizedWrite("W3_2")</script></span> : 
			<strong></strong>
		</div> -->
		<div id="scroll" class="vbox">
		<!-- contents_Start -->
			<ul id="list"></ul>
		<!-- //contents_End -->
		</div>

		<!-- btnArea -->		
		<div class="fix_bottom f_btnArea">
			<button type="button" id="mk_a00_0010" class="btn_red off" disabled="disabled"><!-- Save -->
				<script type="text/javascript">M.locale.localizedWrite("E1_25")</script>
			</button>
		</div>
	</section>

	<footer id="footer">
		<p class="img">KIA, The Power to Surprise.</p>
	</footer>
</div>

<!-- ========== //End ========== -->
</body>
<script type="text/javascript" src="../js/ui/common.js"></script>
<script type="text/javascript">
var gvlWasLang=M.locale.get();

// move to License(mk_a00_0010) screen when Confirm button is touched
// “Confirm” 버튼 터치 시 법적 동의 화면( mk_a00_0010)으로 이동한다
$("#mk_a00_0010").click(Page.moveToPageForId);
M.onReady(function(e){
});

function initCountrySelect(){
	var countryCode = "KM"+exWNgetNetworkCountry();

	if(countryCode != ""){
		countryCode = countryCode.toUpperCase();
        
		$("#list input").each(function(){
			if($(this).data("marketid") == countryCode){
				console.log("marketId : " , $(this).data("marketid"))
				$(this).click();

				$(".selected-country > strong").text($(this).prev("label").text());
			}
		});
	}
}

// show countries list
// 리스트를 화면에 표시한다.
gfnInitList();
function gfnInitList(){
	var supportList=[];
	supportList.push(
		{
			title:"België",
			culturecode:"nl-BE",
			marketid:"KMBE",
			open:true
		}
	);
	supportList.push(
		{
			title:"Belgique",
			culturecode:"fr-BE",
			marketid:"KMBE",
			open:true
		}
	);
	supportList.push(
		{
			title:"Luxembourg",
			culturecode:"fr-LU",
			marketid:"KMBE",
			open:true
		}
	);
	supportList.push(
		{
			title:"Česká Republika",
			culturecode:"cs-CZ",
			marketid:"KMCZ",
			open:true
		}
	);
	supportList.push(
		{
			title:"Deutschland",
			culturecode:"de-DE",
			marketid:"KMDE",
			open:true
		}
	);
	supportList.push(
		{
			title:"España",
			culturecode:"es-ES",
			marketid:"KMES",
			open:true
		}
	);
	supportList.push(
		{
			title:"France",
			culturecode:"fr-FR",
			marketid:"KMFR",
			open:true
		}
	);
	supportList.push(
		{
			title:"Ireland",
			culturecode:"en-IE",
			marketid:"KMIE",
			open:true
		}
	);
	supportList.push(
		{
			title:"Italia",
			culturecode:"it-IT",
			marketid:"KMIT",
			open:true
		}
	);
	supportList.push(
		{
			title:"Magyarország",
			culturecode:"hu-HU",
			marketid:"KMHU",
			open:true
		}
	);
	supportList.push(
		{
			title:"Österreich",
			culturecode:"de-AT",
			marketid:"KMAT",
			open:true
		}
	);
	supportList.push(
		{
			title:"Polski",
			culturecode:"pl-PL",
			marketid:"KMPL",
			open:true
		}
	);
	supportList.push(
		{
			title:"Slovensko",
			culturecode:"sk-SK",
			marketid:"KMSK",
			open:true
		}
	);
	supportList.push(
		{
			title:"Sverige",
			culturecode:"sv-SE",
			marketid:"KMSE",
			open:true
		}
	);
	
	// display list
	// 리스트를 화면에 표시한다.
	[].forEach.call(supportList,function(item,idx){
		if(item.open&&M.locale.DevMode==false){
			create();
		}else if(M.locale.DevMode){
			create();
		}
		function create(){
			var li=$("<li></li>").addClass("hbox jc"),
			label=$("<label for='rd"+idx+"' class='flex'>"+item.title+"</label>"),
			input=$("<input type='radio' name='rd01' data-culturecode='"+item.culturecode+"' id='rd"+idx+"' data-marketid='"+item.marketid+"'/>");
			li.append(label).append(input);
			$("#list").append(li);
		}
	});

	// when selected a country
	// 국가 선택 시
	$("#list input").each(function(i,item){
		$(item).on("click", function(){
            $("#mk_a00_0010").removeClass("off");
            $("#mk_a00_0010").prop("disabled",false);
            var culturecode=$(this).data("culturecode");
            if(gvlWasLang!=culturecode) gfnSend(culturecode);

           // $(".selected-country > strong").text($(this).prev("label").text());
        });
	});

	// add check when saved language and selected language are same
	// 저장된 언어와 리스트언어를 비교해서 같을경우 check 표시한다.
	$("#list input").each(function(i,item){
		if(gvlWasLang==$(item).data("culturecode")){
			$(item).prop("checked",true);
			$("#mk_a00_0010").removeClass("off");
			$("#mk_a00_0010").prop("disabled",false);
			M.data.global(Storage.CultureCode, gvlWasLang);

			// $(".selected-country > strong").text($(item).prev("label").text());
		}
	});

    // initCountrySelect();
}

// call API 2.28 when selected a country
// 국가 선택 시 API 2.28 통신을 시작한다
function gfnSend(culturecode){
	var callback={
		success:function(rev,setting){

			// save translation language to the storage
			// 성공 시 해당 언어에 대한 번역 정보를 스토리지에 저장한다.
			// if(culturecode=="en-US") M.locale.set(culturecode);
			// else if(rev.Translations.length!=0) gfnGenerater(rev,culturecode);
			if(rev.Translations.length!=0) gfnGenerater(rev,culturecode);
		},
		error:function(code,msg){

			// recovery existing language when network communication failed
			// 실패시 기존에 저장되어 있던 언어로 원복 한다.
			$("#list input").each(function(i,item){
				if(gvlWasLang==$(item).data("culturecode")){
					$(item).prop("checked",true);
				}else{
					$(item).prop("checked",false);
				}
			});
			$("#mk_a00_0010").addClass("off");
			$("#mk_a00_0010").prop("disabled",true);
		}
	};
	if(culturecode == 'de-DE'){
		MApi.storage(Storage.TargetServer, M.locale.DevMode ? "HTTPS_RHM_KMD_ACCEPT" : "HTTPS_RHM_KMD");
	}else{
		MApi.storage(Storage.TargetServer, M.locale.DevMode ? "HTTPS_RHM_ACCEPT" : "HTTPS_RHM");
	}
	
	new NetworkManager(TrCode.TranslationList,callback,false).send({"CultureCode":culturecode});
}

// save translation language to the storage
// 성공 시 해당 언어에 대한 번역 정보를 스토리지에 저장한다.
function gfnGenerater(data,culturecode){
	var gen={};
	[].forEach.call(data.Translations,function(item){
		for(var i in item){
			gen[i]=item[i];
		}
	});
	gvlWasLang=culturecode;
	M.data.global(Storage.CultureCode, culturecode);
	MApi.storage(culturecode,gen);
	M.locale.set(culturecode);
}
M.onBack=function(e){};
</script>
</html>