<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no, address=no, email=no">
<title>MyKia :: Maintenance Schedule :: list</title>
<link rel="stylesheet" type="text/css" href="../css/morpheus_style.css">
<style>
.tmp{
	position: absolute;
	width:18rem !important;
    right: .7rem;
    margin-top:-0.6rem;
    height:2.5rem !important;
}
div.t_tit.tmp2{
    position: absolute;
}

</style>
<script type="text/javascript" src="../js/mcore.min.js"></script>
</head>
<body id="mk_c04_0001">
<!-- ========== Start ========== -->

    <!-- LayerPop -->
    <div class="lightbox none"></div>
    <div class="popup mk_c04_0002 none" id="popup">
        <div class="popup_m">
            <div class="popup_in">
                <div class="p_header">
                    <strong><!-- Update Mileage --><script type="text/javascript">M.locale.localizedWrite("D1_1")</script></strong>
                    <button class="pbtn close pl" id="popupClose">Close</button>
                </div>
                <div class="p_body mileage_space">
                    <strong><!-- Please update your mileage! --><script type="text/javascript">M.locale.localizedWrite("E1_43")</script></strong>
                    <input type="tel" id="popupInputMileage"/>
                    <p class="km">Km</p>
                </div>
                <div class="p_footer">
                    <button type="button" id="popupSave" class="off" disabled="disabled"><!-- SAVE -->
                        <script type="text/javascript">M.locale.localizedWrite("B1_3")</script>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="popup mk_c04_0002 none" id="popup_last">
        <div class="popup_m">
            <div class="popup_in">
                <div class="p_header">
                    <strong><!-- Update Mileage --><script type="text/javascript">M.locale.localizedWrite("L1_6")</script></strong>
                    <button class="pbtn close pl" id="popupLastClose">Close</button>
                </div>
                <div class="p_body lastservice_space" id="lastServiceArea">
                    <strong style="display: inline-block; width: 100%;"><!-- Please update your mileage! --><script type="text/javascript">M.locale.localizedWrite("E1_44")</script></strong>
                </div>
                <div class="p_footer">
                    <button type="button" id="lastServiceSave" class="off" disabled="disabled"><!-- SAVE -->
                        <script type="text/javascript">M.locale.localizedWrite("B1_3")</script>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- //LayerPop -->


<div id="wrapper">
	<header id="header">
		<h1><!-- Maintenance Schedule --><script type="text/javascript">M.locale.localizedWrite("E1_34")</script></h1>
		<button type="button" class="hbtn fl home">Home</button>
	</header>

	<section id="container">
		<div id="scroll">
        <!-- contents_Start -->
            
			<div class="car_info">
				<img class="img_car_info" id="carImage" alt=""/>
				<h2 id="car">&nbsp;</h2>
				<button type="button" class="ve_set" style="display:none;" id="mk_a00_0004">Setting</button>
			</div>

			<div class="mileage_info">
				<ul>
					<li id="lastService"><!--Last service checkup-->
						<button type="button" class="hbtn fr setting" id="updateLastservice"><script type="text/javascript">M.locale.localizedWrite("D1_1")</script></button>
                        <script type="text/javascript">M.locale.localizedWrite("B1_8")</script> :
                        <em></em>
                    </li>
					<li id="mileage"><!-- Mileage -->
		                <button type="button" class="hbtn fr setting" id="update"><script type="text/javascript">M.locale.localizedWrite("D1_1")</script></button>
                        <script type="text/javascript">M.locale.localizedWrite("B1_11")</script> :
                        <em></em>
                    </li>
                    <li id="mileageSetDate"><!--Mileage Update Date-->
                    	<script type="text/javascript">M.locale.localizedWrite("B1_47")</script> : 
                    	<em></em>
                    </li>
					<li id="registered"><!-- Registered -->
                        <script type="text/javascript">M.locale.localizedWrite("B1_15")</script> :
                        <em></em>
                    </li>
					<li id="usage"><!-- Usage -->
                        <script type="text/javascript">M.locale.localizedWrite("B1_16")</script> :
                        <em></em>
                    </li>
                    <li id="plate"></li>
				</ul>
			</div>
            
			<div class="appo_space">
				<strong id="name">&nbsp;</strong>
				<p>&nbsp;</p>
				<!-- <!-- press시 class on 추가/disable시 class off 추가
				<button class="btn_white">Make an appointment<script type="text/javascript">M.locale.localizedWrite("E1_20")</script></button> -->
			</div>

			<button type="button" class="my_appointments"><script type="text/javascript">M.locale.localizedWrite("W0_12")</script></button>
            
			<div class="timeline_space none">
				<h3><!-- Maintenance Checklist --><script type="text/javascript">M.locale.localizedWrite("E1_41")</script></h3>
				<ul id="checkList">
					<!--start-->
					<li class="t_start none">
						<p class="t_icon">point icon</p>
						<div class="t_sub">
							<!-- <p class="t_data">Approx. mileage :   Km</p>
							<p class="t_data">Last update by you at  with  km </p>
							<span class="t_date"><span>Start</span> &nbsp;</span> -->
						</div>
					</li>
					<!-- 열려있는 경우 (class open) 오늘(class today)>
					<li class="open today">		
						<p class="t_icon">point icon</p>
						<div class="t_sub">
							<p class="tit">Checkup is needed at 30,000Km</p>
							열려있는 경우에만 보여지는 부분
							<div class="t_subdata">
								<p class="t_tit">Service operations will be done at the 30,000Km service :</p>
								<p class="t_data">Attach GDS and look for trouble codes & updates</p>
								<p class="t_data">Remote control for fuctioning properly</p>
								<span class="t_date"><span>Today</span> 02.12.13</span>
							</div>
						</div>
					</li>
					닫혀있는 경우 class 없음
					<li class="">
						<p class="t_icon">point icon</p>
						<div class="t_sub">
							<p class="tit">Checkup is needed at 35,000Km</p>
							열려있는 경우에만 보여지는 부분
							<div class="t_subdata">
								<p class="t_tit">Service operations will be done at the 30,000Km service :</p>
								<p class="t_data">Attach GDS and look for trouble codes & updates</p>
								<p class="t_data">Remote control for fuctioning properly</p>
								<span class="t_date">02.12.13</span>
							</div>
						</div>
					</li>
					<li class="open">
						<p class="t_icon">point icon</p>
						<div class="t_sub">
							<p class="tit">Checkup is needed at 35,000Km</p>
							열려있는 경우에만 보여지는 부분
							<div class="t_subdata">
								<p class="t_tit">Service operations will be done at the 30,000Km service :</p>
								<p class="t_data">Attach GDS and look for trouble codes & updates</p>
								<p class="t_data">Remote control for fuctioning properly</p>
								<span class="t_date">02.12.13</span>
							</div>
						</div>
					</li> -->
				</ul>
			</div>
            
            <!-- No Search Result -->
            <div>
                <p class="result_none_p none"><script type="text/javascript">M.locale.localizedWrite("D1_19")</script></p>
            </div>
        <!-- //contents_End -->    
		</div>
	</section>

	<footer id="footer">
		<p class="img">KIA, The Power to Surprise.</p>
	</footer>
</div>

<!-- ========== //End ========== -->
</body>
<script type="text/javascript" src="../bower_components/moment/min/moment-with-locales.min.js"></script>
<script type="text/javascript" src="../js/ui/common.js"></script>
<script type="text/javascript">

// 선택 차량 변경 아이콘 터치 시 차량 선택 화면(mk_a00_0004)으로 이동한다.
$("#mk_a00_0004").data(Scheme.Param,{backData:true});
$("#mk_a00_0004").click(Page.moveToPageModalUp);

// “Update Mileage”버튼 터치 시 마일리지 입력 팝업을 표시 한다.
$("#update").click(function(){
	$("#popup").removeClass('none');
	$(".lightbox").removeClass('none');
});
//“Update LastService”버튼 터치 시 마일리지 입력 팝업을 표시 한다.
$("#updateLastservice").click(function(){
	$("#popup_last").removeClass('none');
	$(".lightbox").removeClass('none');
});

// 업데이트 마일리지 팝업 닫기 버튼 터치 시 팝업이 닫힌다
$("#popupClose").click(gfnPopupClose);
$("#popupInputMileage").keyup(gfnInputMileageValidate);

$("#popupLastClose").click(gfnPopupLastClose);

// 업데이트 마일리지 팝업에 “Save”버튼 터치 시 API 2.11 통신을 시작한다
$("#popupSave").click(gfnUpdateMileage);
$("#lastServiceSave").click(gfnUpdateLastService);
var gvlReloadFlag=true;

// 최초 진입 시 선택 보유한 차량의 정보를 표시한다.
function gfnInit(){
	// 2017.02.28 차량정보 조회 
	var gvlVehiclesInformationCallback={
	    success:function(rev,setting){
	        var vehicles=LoginManager.getVehiclesInfo();
	        // reload vehichle all data
	        $.extend( true, vehicles.Vehicles, rev.Vehicles );
			// VIN decrypt
			for(var i=0;i<vehicles.Vehicles.length;i++){
				vehicles.Vehicles[i].VIN=exRHMDecrypt(vehicles.Vehicles[i].VIN);
			}
	        
			LoginManager.setVehiclesInfo(vehicles);

			// DisplaySetting
			gfnDisplaySetting();
	    }
	};
	// 2.6 Get user’s vehicle information (ALL)
	var VehiclesNetwork=new NetworkManager(TrCode.VehiclesInformation,gvlVehiclesInformationCallback,false);
	var data={
		"CustomerId":LoginManager.getCustomerId()
	};
	VehiclesNetwork.send(data);
}

function gfnDisplaySetting(){
	var myvehicle=LoginManager.getSelectedVehiclesInfo();
	var detailsInfo=LoginManager.getDetailsInfo();
	$("#car").text(myvehicle.VehicleName);
	
	// hide when no last maintenance date is available
    // 마지막 서비스 일자가 없을시 마지막 서비스 일자를 숨
    if(myvehicle.LastServiceDate != null && myvehicle.LastServiceDate.trim().length > 0){
    	$("#lastService em").text(JsUtil.MomentDateFormat(myvehicle.LastServiceDate, 'L'));
    	$("#lastService").show();
    }else{
    	$("#lastService").remove();
    }
	
	if (M.locale.VirtualMode) {
		$("#carImage").attr("src","data:"+myvehicle.VehicleImageExtension+";base64,"+myvehicle.VehicleImage);
	} else {
		$("#carImage").attr("src", myvehicle.VehicleImageUrl);
	}
	$("#mileage em").text(JsUtil.addComma(myvehicle.CurrentMileageInKilometers)+" km");

	// mileage update date
    if(myvehicle.CurrentMileageSetDate){
    	$("#mileageSetDate em").html(JsUtil.MomentDateFormat(myvehicle.CurrentMileageSetDate, 'L'));
    	$("#mileageSetDate").show();
    }else{
    	$("#mileageSetDate").hide();
    }

    if(myvehicle.RegistrationDate != ""){
    	$("#registered em").text(JsUtil.MomentDateFormat(myvehicle.RegistrationDate, 'L'));
    }

	$("#usage em").text(JsUtil.addComma(myvehicle.UsagePerYear)+" km/"+M.locale.localizedString("V1_3"));
	if (LoginManager.getDetailsInfo().MarketId == 'KMSE' && myvehicle.Licenseplate) {
		$("#plate em").text(myvehicle.Licenseplate);
	}else{
		$("#plate").hide();
	}
	
	// $("#name").text(detailsInfo.FirstName+" "+detailsInfo.LastName);
	$("#name").text(detailsInfo.FirstName+",");
	if(LoginManager.getVehiclesInfo().Vehicles.length>1) $("#mk_a00_0004").show();
	var maintenanceCallback = {
		success : function(result, setting) {

			if(LoginManager.getDetailsInfo().MarketId != "KMBE"){
				if(result.Plans == undefined || result.Plans == null){
					$(".result_none_p").removeClass('none');

					return;
				}else{
					if($(".result_none_p").hasClass("none") === true) {
						$(".timeline_space").removeClass('none');
						$(".result_none_p").addClass('none');
					}
				}
			}

			// API 2.12 통신 결과 성공 시 결과를 리스트로 표시한다
			$("#checkList > li:not(.t_start)").remove();

			var appo_space = "";

			if(LoginManager.getDetailsInfo().MarketId == "KMDE"){
				appo_space = M.locale.localizedString("S1_27");

				appo_space = appo_space.replace("{ServiceSuggestionMileage}",myvehicle.CurrentMileageInKilometers)
				appo_space = appo_space.replace("{ServiceSuggestionMonths}",JsUtil.MomentDateFormat(myvehicle.NextServiceDate, 'L'))
			}else{
				appo_space = M.locale.localizedString("S1_27")+ " " + JsUtil.MomentDateFormat(myvehicle.NextServiceDate, 'L')
			}

			$(".appo_space > p").text(appo_space);

			/*
			$(".t_start > .t_sub").html("");
			$(".t_start > .t_sub")
				.append($("<p></p>").text(M.locale.localizedString("S1_28")+ " " + JsUtil.addComma(myvehicle.CurrentMileageInKilometers) + " km").addClass("t_data"))
				.append($("<p></p>").text(JsUtil.stringFomatter(M.locale.localizedString("S1_29"), [JsUtil.MomentDateFormat(myvehicle.LastServiceDate.substring(0, 8), 'L')])+ " " + JsUtil.addComma(myvehicle.LastServiceMileageInKilometers) + " km ").addClass("t_data"))
				.append($("<span></span>").append($("<span></span>").text(M.locale.localizedString("V1_8"))).append(" " + JsUtil.MomentDateFormat(myvehicle.RegistrationDate.substring(0, 8), 'L')).addClass("t_date"))
			*/

			// HideNextServiceDate == true이면 이름을 표시안한다.
			if (result.HideNextServiceDate == true || result.HideNextServiceDate == 'true') {
				$('.appo_space').hide()
			} else {
				$('.appo_space').show()
			}

			$(result.Plans).each(function(idx, item) {
				var description=item.Description;
				// item.Description=null;
				// description=null;
				if(description==null) description=M.locale.localizedString("E1_51");

				var temp = $("<li></li>")
					.append($("<p></p>").text("point icon").addClass("t_icon"))
					.append($("<div></div>").addClass("t_sub")
					.append($("<p></p>").text(M.locale.localizedString("V1_9") + " " + JsUtil.addComma(item.ServiceplanMileage) + " km").addClass("tit"))
					.append($("<div></div>").addClass("t_subdata")
					.append($("<div></div>").text(description).addClass("t_tit"))
				));

				if(item.Description==null){
					var button=$('<button class="btn_white tmp"></button>').text(M.locale.localizedString("S1_15"));
					
					
					button.click(function(){
						var params={};
						params.tab="contact";
						var options = Options.Default;
						options.param=params;
						Page.moveToPage("mk_c01_0001",options);
						gvlReloadFlag=false;
					});
					temp.find(".t_subdata").append(button);
					temp.find(".t_tit").addClass("tmp2");
				}

				temp.data("checkupMileage", item.ServiceplanMileage).appendTo($("#checkList"));
				
				$(item.ServiceOptions).each(function(index, thatItem) {
					if(thatItem.Category!=null){
						temp.find(".t_subdata")
							.append($("<p></p>").text(thatItem.Category).addClass("t_tit"));
						
						$(thatItem.Options).each(function(theIdx, optionItem) {
							temp.find(".t_subdata")
								.append($("<p></p>").text(optionItem).addClass("t_data"));
						});
					}
				});
				
				temp.find(".t_subdata")
					.append($("<span></span>").text(JsUtil.MomentDateFormat(item.ServiceDate, 'L')).addClass("t_date"));
			});

			// 리스트 터치 시 상세 내용이 열려 있는 경우 상세 내용이 아래로 펼쳐진다.
			// 상세 내용이 닫혀 있는 경우 상세 내용이 위로 닫힌다.
			// $("#checkList > li:not(.t_start)").click(function() {
			$("#checkList .tit").click(function() {
				$(this).parent().parent().toggleClass("open");
			});
			gfnRedLineMark();
		}
	}

	// API 2.12 통신을 시작한다.
	var maintenanceNetwork=new NetworkManager(TrCode.MaintainanceSchedule,maintenanceCallback,true);
	var myvehicle=LoginManager.getSelectedVehiclesInfo();
	var data={
		"CustomerId":LoginManager.getCustomerId(),
		"VIN":myvehicle.VIN
	};
	maintenanceNetwork.send(data);
}

function gfnRedLineMark(){
	var myvehicle=LoginManager.getSelectedVehiclesInfo(),
		itemList = $("#checkList > li:not(.t_start)");
	
	$(itemList).each(function(idx, item) {
		if ($(item).data("checkupMileage") - myvehicle.CurrentMileageInKilometers > 0) {
			$(item).addClass("today");
			return false;
		}
	});
}

// “Update Mileage”버튼 터치 시 마일리지 입력 팝업을 표시 한다.
function gfnUpdate(){
	//$("#popup").show();
	//$(".lightbox").show();
	$("#popup").removeClass('none');
	$(".lightbox").removeClass('none');
}

// 업데이트 마일리지 팝업 닫기 버튼 터치 시 팝업이 닫힌다
function gfnPopupClose(){
	//$("#popup").hide();
	//$(".lightbox").hide();
	$("#popup").addClass('none');
	$(".lightbox").addClass('none');
	$("#popupSave").prop("disabled",true);
    $("#popupSave").addClass("off");
	$("#popupInputMileage").val("");
}

function gfnPopupLastClose(){
	$("#popup_last").addClass('none');
	$(".lightbox").addClass('none');
	$("#lastServiceSave").prop("disabled",true);
    $("#lastServiceSave").addClass("off");
	$("#day").val("");
	$("#month").val("");
	$("#year").val("");
}

// 마일리지 값 검증
function gfnInputMileageValidate(){
    var val=JsUtil.mfnNumberOnlyFilter($(this).val());
    var maxLength=6;
    if(val!=""){
    	val=val.replace(/,|\.| /g,"");
    	if(val.length>maxLength)val=val.substr(0,maxLength);
    	if(val>240000) val=240000;
    	val=JsUtil.addComma(val);
    }
    $(this).val(val);
    if(val==0){
        $("#popupSave").prop("disabled",true);
        $("#popupSave").addClass("off");
    }else{
        $("#popupSave").prop("disabled",false);
        $("#popupSave").removeClass("off");
    }
}
// LastService 값 검증
// 일검증 
function gfnInputDayValidate(){
    var val=JsUtil.mfnNumberOnlyFilter($(this).val());
    var maxDay = 31;
    if(val > maxDay) val = maxDay;
    $(this).val(val);

    gfnInputLastServiceValidate();
}
//월검증 
function gfnInputMonthValidate(){
    var val=JsUtil.mfnNumberOnlyFilter($(this).val());
    var maxMonth = 12;
    if(val > maxMonth) val = maxMonth;
    $(this).val(val);

    gfnInputLastServiceValidate();
}
// 년도검증 
function gfnInputYearValidate(){
    var val=JsUtil.mfnNumberOnlyFilter($(this).val());
    $(this).val(val);

    gfnInputLastServiceValidate();
}

function gfnInputLastServiceValidate(){
	var year = JsUtil.mfnNumberOnlyFilter($('#year').val()),
		month = JsUtil.mfnNumberOnlyFilter($('#month').val()),
		day = JsUtil.mfnNumberOnlyFilter($('#day').val());
	
	if( year>0 && year.length==4 && month>0 && day>0){
		$("#lastServiceSave").prop("disabled",false);
        $("#lastServiceSave").removeClass("off");
	}else{
		$("#lastServiceSave").prop("disabled",true);
        $("#lastServiceSave").addClass("off");
	}
}

// 업데이트 마일리지 팝업에 “Save”버튼 터치 시 API 2.11 통신을 시작한다
function gfnUpdateMileage(){
	/**
	* 마일리지가 업데이트 되는동안 back key가 동작 하지 않게끔 조건식을 주기위해
	* body에 현재 페이지의 id값을 클래스로 추가
	* common.js의 M.onBack() 함수 내부에 조건식 추가
	*/
	$("#popupInputMileage").blur();
	$('body').addClass('mk_c04_0001');
	var mileageInKilometers = $("#popupInputMileage").val().replace(/,|\.| /g,"");
	gfnPopupClose();
	var callback={
		success:function(rev,setting){

			// API 2.11 통신 결과 성공 시 최초 진입 시 처리 로직이 진행된다. 
			// 업데이트 마일리지 팝업이 닫힌다
			/* var vehiclesInfo=LoginManager.getVehiclesInfo();
			vehiclesInfo.Vehicles[LoginManager.getSelectedVehiclesIndex()].CurrentMileageInKilometers=$("#popupInputMileage").val().replace(/,/g,"");
			LoginManager.setVehiclesInfo(vehiclesInfo);
			gfnDisplaySetting(); */
			gfnInit();
			M.pop.instance(M.locale.localizedString("R1_1"));
			
			/**
			* 마일리지 업데이트 후 back key 제어의 조건식이 되는 클래스 제거
			*/
			$('body').removeClass('mk_c04_0001');
		}
	};
	var MileageUpdatingNetwork=new NetworkManager(TrCode.MileageUpdating,callback,false);
	var myvehicle=LoginManager.getSelectedVehiclesInfo();
	var data={
		"CustomerId":LoginManager.getCustomerId(),
		"VIN":myvehicle.VIN,
		"MileageInKilometers":mileageInKilometers
	};
	MileageUpdatingNetwork.send(data);
}

//업데이트 LastService 팝업에 “Save”버튼 터치 시 API 2.38 통신을 시작한다
function gfnUpdateLastService(){
	/**
	* LastService가 업데이트 되는동안 back key가 동작 하지 않게끔 조건식을 주기위해
	* body에 현재 페이지의 id값을 클래스로 추가
	* common.js의 M.onBack() 함수 내부에 조건식 추가
	*/
	$("#day").blur();
	$("#month").blur();
	$("#year").blur();
	$('body').addClass('mk_c04_0001');
	var year = JsUtil.prependZeros($("#year").val(),4),
		month = JsUtil.prependZeros($("#month").val(),2),
		day = JsUtil.prependZeros($("#day").val(),2),
		lastServiceDate = year+"-"+month+"-"+day,
		registrationDate = LoginManager.getSelectedVehiclesInfo().RegistrationDate.substring(0, 8),
		current = new Date(),
		today = current.getFullYear()+''+JsUtil.prependZeros(current.getMonth()+1,2)+''+JsUtil.prependZeros(current.getDate(),2),
		CurrentLastServiceDate = LoginManager.getSelectedVehiclesInfo().LastServiceDate.substring(0,8);

	// registrationDate 보다 낮은값을 등록 할 수 없음
	if(Number(year+""+month+""+day) <= Number(registrationDate)){
		MApi.alert(M.locale.localizedString("Y2_18"));
		return false;
	}
	// 오늘보다 이후의 날짜는 등록할 수 없음
	else if(Number(year+""+month+""+day) > Number(today)){
		MApi.alert(M.locale.localizedString("Y2_18"));
		return false;
	}
	// 현재 마지막 서비스 날짜보다 이후 날짜는 등록할 수 없음.
	else if(CurrentLastServiceDate > Number(year+""+month+""+day)){
		MApi.alert(M.locale.localizedString("Y2_18"));
		return false;
	}
	gfnPopupLastClose(); 
	var callback={
		success:function(rev,setting){

			// API 2.38 통신 결과 성공 시 최초 진입 시 처리 로직이 진행된다. 
			// 업데이트 LastService 팝업이 닫힌다
			gfnInit();
			M.pop.instance(M.locale.localizedString("R1_2"));
			/**
			* 마일리지 업데이트 후 back key 제어의 조건식이 되는 클래스 제거
			*/
			$('body').removeClass('mk_c04_0001');
		}
	};
	var LastServiceUpdatingNetwork=new NetworkManager(TrCode.LastServiceUpdate,callback,false);
	var data={
		"CustomerId":LoginManager.getCustomerId(),
		//"VINnoPackage":LoginManager.getSelectedVehiclesInfo().VIN,	// 암호화 하지 않으려고 만든 VIN 필드
		"VIN":LoginManager.getSelectedVehiclesInfo().VIN,	// 암호화 하지 않으려고 만든 VIN 필드
		"DateOfLastService":lastServiceDate
	};
	LastServiceUpdatingNetwork.send(data);
}

// 최초 진입 시
M.onReady(function(e){
	/**
	 * iOS 7 이하에서 keyboard blur시 화면 resize 버그 때문에 
	 * focus시 footer를 hide 시킴
	 */
	var os = M.info.device().os
	if (os.name === 'iPhone OS' && parseInt(os.version, 10) < 8) {
		$('.lightbox').hide();
	}

	gfnInit();

	$(".my_appointments").click(function(){
		if(M.locale.VirtualMode || exWNNetworkConnectionCheck() == "YES"){
			Page.moveToTargetPage($(this), this);
		}else{
			MApi.alert(M.locale.localizedString("V1_6"));
			return false;
		}
	});

	// lastServiceDate Format
	if(LoginManager.getDetailsInfo().MarketId.match("KMSE")){
		$('<input type="tel" id="year" maxlength="4" style="width: 40%;" placeholder="YYYY"/>').appendTo('#lastServiceArea');
	    $('<input type="tel" id="month" maxlength="2" style="width: 28%;" placeholder="MM"/>').appendTo('#lastServiceArea');
	    $('<input type="tel" id="day" maxlength="2" style="width: 28%;" placeholder="DD"/>').appendTo('#lastServiceArea');
	}else{
		$('<input type="tel" id="day" maxlength="2" style="width: 28%;" placeholder="DD"/>').appendTo('#lastServiceArea');
	    $('<input type="tel" id="month" maxlength="2" style="width: 28%;" placeholder="MM"/>').appendTo('#lastServiceArea');
		$('<input type="tel" id="year" maxlength="4" style="width: 40%;" placeholder="YYYY"/>').appendTo('#lastServiceArea');
	}

	$("#day").keyup(gfnInputDayValidate);
	$("#month").keyup(gfnInputMonthValidate);
	$("#year").keyup(gfnInputYearValidate);
});

// 차량 선택 화면으로부터 화면이 복원 됐을 경우 최초 진입 시 처리 로직이 진행된다.
M.onRestore(function(e){
	if(gvlReloadFlag) gfnInit();
	gvlReloadFlag=true;
});

/**
 * iOS 7 이하에서 keyboard blur시 화면 resize 버그 때문에 
 * focus시 footer를 hide 시킴
 */
$("#popupInputMileage").focus(focusListner);
$("#popupInputMileage").blur(blurListner);
function focusListner() {
	var os = M.info.device().os
	if (os.name === 'iPhone OS' && parseInt(os.version, 10) < 8) {
		$('#footer').hide();
	}
}
function blurListner() {
	//gfnPopupClose();
}
</script>
</html>